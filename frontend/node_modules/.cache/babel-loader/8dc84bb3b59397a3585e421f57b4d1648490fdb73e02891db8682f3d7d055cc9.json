{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{useAuth}from'./AuthContext';import{io}from'socket.io-client';import{autoDetectBackendUrl}from'../utils/networkUtils';// Create context\nimport{jsx as _jsx}from\"react/jsx-runtime\";const SocketContext=/*#__PURE__*/createContext();// Socket Provider Component\nexport const SocketProvider=_ref=>{let{children}=_ref;const{user,isAuthenticated}=useAuth();const[socket,setSocket]=useState(null);const[connected,setConnected]=useState(false);const[onlineUsers,setOnlineUsers]=useState([]);// Real socket connection\nuseEffect(()=>{if(isAuthenticated&&user){console.log('Socket baƒülantƒ±sƒ± ba≈ülatƒ±lƒ±yor...');// Auto-detect socket URL\nautoDetectBackendUrl().then(apiUrl=>{// Convert API URL to Socket URL\nconst socketUrl=apiUrl.replace('/api','');console.log('üîå Socket URL:',socketUrl);const newSocket=io(socketUrl,{auth:{token:localStorage.getItem('token')},transports:['polling'],timeout:10000,reconnection:true,reconnectionAttempts:5,reconnectionDelay:1000});newSocket.on('connect',()=>{console.log('Socket connected:',newSocket.id);setConnected(true);setSocket(newSocket);});newSocket.on('disconnect',reason=>{console.log('Socket disconnected:',reason);setConnected(false);setOnlineUsers([]);});newSocket.on('connect_error',error=>{console.error('Socket connection error:',error);setConnected(false);});newSocket.on('reconnect',attemptNumber=>{console.log('Socket reconnected after',attemptNumber,'attempts');setConnected(true);});newSocket.on('onlineUsers',users=>{setOnlineUsers(users);});newSocket.on('notification',notification=>{console.log('New notification received:',notification);});// Socket'i hemen set et ama connected durumunu connect event'inde set et\nsetSocket(newSocket);// Eƒüer socket zaten baƒülƒ±ysa connected'ƒ± true yap\nif(newSocket.connected){console.log('Socket zaten baƒülƒ±, connected true yapƒ±lƒ±yor');setConnected(true);}return()=>{console.log('Socket cleanup...');newSocket.close();};});}else{setConnected(false);setOnlineUsers([]);if(socket){socket.close();setSocket(null);}}},[isAuthenticated,user]);// Real socket functions\nconst emitEvent=(eventName,data)=>{if(socket&&connected){socket.emit(eventName,data);return true;}return false;};const joinRoom=roomName=>{if(socket&&connected){socket.emit('joinRoom',roomName);return true;}return false;};const leaveRoom=roomName=>{if(socket&&connected){socket.emit('leaveRoom',roomName);return true;}return false;};const sendNotification=notification=>{if(socket&&connected){socket.emit('sendNotification',notification);return true;}return false;};const updateUserStatus=status=>{if(socket&&connected){socket.emit('updateStatus',status);return true;}return false;};const broadcastToRole=(role,message)=>{console.log('Mock broadcast to role:',role,message);return true;};const isUserOnline=userId=>{return onlineUsers.some(user=>user.userId===userId);};const getOnlineUsersByRole=role=>{return onlineUsers.filter(user=>user.role===role);};const getOnlineUsersCount=()=>{return onlineUsers.length;};const disconnectSocket=()=>{setConnected(false);setOnlineUsers([]);console.log('Mock socket disconnected');};const value={socket,// Ger√ßek socket\nconnected,onlineUsers,// Functions\nemitEvent,joinRoom,leaveRoom,sendNotification,updateUserStatus,broadcastToRole,// Utility functions\nisUserOnline,getOnlineUsersByRole,getOnlineUsersCount,// Control functions\ndisconnectSocket};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:value,children:children});};// Hook to use socket context\nexport const useSocket=()=>{const context=useContext(SocketContext);if(!context){throw new Error('useSocket must be used within a SocketProvider');}return context;};export default SocketContext;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useAuth","io","autoDetectBackendUrl","jsx","_jsx","SocketContext","SocketProvider","_ref","children","user","isAuthenticated","socket","setSocket","connected","setConnected","onlineUsers","setOnlineUsers","console","log","then","apiUrl","socketUrl","replace","newSocket","auth","token","localStorage","getItem","transports","timeout","reconnection","reconnectionAttempts","reconnectionDelay","on","id","reason","error","attemptNumber","users","notification","close","emitEvent","eventName","data","emit","joinRoom","roomName","leaveRoom","sendNotification","updateUserStatus","status","broadcastToRole","role","message","isUserOnline","userId","some","getOnlineUsersByRole","filter","getOnlineUsersCount","length","disconnectSocket","value","Provider","useSocket","context","Error"],"sources":["/Users/hakankarahan/Desktop/fabrikayazilimi/frontend/src/contexts/SocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { useAuth } from './AuthContext';\nimport { io } from 'socket.io-client';\nimport { autoDetectBackendUrl } from '../utils/networkUtils';\n\n// Create context\nconst SocketContext = createContext();\n\n// Socket Provider Component\nexport const SocketProvider = ({ children }) => {\n  const { user, isAuthenticated } = useAuth();\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n\n  // Real socket connection\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      console.log('Socket baƒülantƒ±sƒ± ba≈ülatƒ±lƒ±yor...');\n      \n      // Auto-detect socket URL\n      autoDetectBackendUrl().then(apiUrl => {\n        // Convert API URL to Socket URL\n        const socketUrl = apiUrl.replace('/api', '');\n        console.log('üîå Socket URL:', socketUrl);\n        \n        const newSocket = io(socketUrl, {\n        auth: {\n          token: localStorage.getItem('token')\n        },\n        transports: ['polling'],\n        timeout: 10000,\n        reconnection: true,\n        reconnectionAttempts: 5,\n        reconnectionDelay: 1000\n      });\n\n      newSocket.on('connect', () => {\n        console.log('Socket connected:', newSocket.id);\n        setConnected(true);\n        setSocket(newSocket);\n      });\n\n      newSocket.on('disconnect', (reason) => {\n        console.log('Socket disconnected:', reason);\n        setConnected(false);\n        setOnlineUsers([]);\n      });\n\n      newSocket.on('connect_error', (error) => {\n        console.error('Socket connection error:', error);\n        setConnected(false);\n      });\n\n      newSocket.on('reconnect', (attemptNumber) => {\n        console.log('Socket reconnected after', attemptNumber, 'attempts');\n        setConnected(true);\n      });\n\n      newSocket.on('onlineUsers', (users) => {\n        setOnlineUsers(users);\n      });\n\n      newSocket.on('notification', (notification) => {\n        console.log('New notification received:', notification);\n      });\n\n      // Socket'i hemen set et ama connected durumunu connect event'inde set et\n      setSocket(newSocket);\n      \n      // Eƒüer socket zaten baƒülƒ±ysa connected'ƒ± true yap\n      if (newSocket.connected) {\n        console.log('Socket zaten baƒülƒ±, connected true yapƒ±lƒ±yor');\n        setConnected(true);\n      }\n\n        return () => {\n          console.log('Socket cleanup...');\n          newSocket.close();\n        };\n      });\n    } else {\n      setConnected(false);\n      setOnlineUsers([]);\n      if (socket) {\n        socket.close();\n        setSocket(null);\n      }\n    }\n  }, [isAuthenticated, user]);\n\n  // Real socket functions\n  const emitEvent = (eventName, data) => {\n    if (socket && connected) {\n      socket.emit(eventName, data);\n      return true;\n    }\n    return false;\n  };\n\n  const joinRoom = (roomName) => {\n    if (socket && connected) {\n      socket.emit('joinRoom', roomName);\n      return true;\n    }\n    return false;\n  };\n\n  const leaveRoom = (roomName) => {\n    if (socket && connected) {\n      socket.emit('leaveRoom', roomName);\n      return true;\n    }\n    return false;\n  };\n\n  const sendNotification = (notification) => {\n    if (socket && connected) {\n      socket.emit('sendNotification', notification);\n      return true;\n    }\n    return false;\n  };\n\n  const updateUserStatus = (status) => {\n    if (socket && connected) {\n      socket.emit('updateStatus', status);\n      return true;\n    }\n    return false;\n  };\n\n  const broadcastToRole = (role, message) => {\n    console.log('Mock broadcast to role:', role, message);\n    return true;\n  };\n\n  const isUserOnline = (userId) => {\n    return onlineUsers.some(user => user.userId === userId);\n  };\n\n  const getOnlineUsersByRole = (role) => {\n    return onlineUsers.filter(user => user.role === role);\n  };\n\n  const getOnlineUsersCount = () => {\n    return onlineUsers.length;\n  };\n\n  const disconnectSocket = () => {\n    setConnected(false);\n    setOnlineUsers([]);\n    console.log('Mock socket disconnected');\n  };\n\n  const value = {\n    socket, // Ger√ßek socket\n    connected,\n    onlineUsers,\n    \n    // Functions\n    emitEvent,\n    joinRoom,\n    leaveRoom,\n    sendNotification,\n    updateUserStatus,\n    broadcastToRole,\n    \n    // Utility functions\n    isUserOnline,\n    getOnlineUsersByRole,\n    getOnlineUsersCount,\n    \n    // Control functions\n    disconnectSocket,\n  };\n\n  return (\n    <SocketContext.Provider value={value}>\n      {children}\n    </SocketContext.Provider>\n  );\n};\n\n// Hook to use socket context\nexport const useSocket = () => {\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n\nexport default SocketContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}