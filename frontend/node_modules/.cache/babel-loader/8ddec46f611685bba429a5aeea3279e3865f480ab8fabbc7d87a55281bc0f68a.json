{"ast":null,"code":"var _jsxFileName = \"/Users/hakankarahan/Desktop/fabrikayazilimi/frontend/src/contexts/SocketContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport { useAuth } from './AuthContext';\nimport { io } from 'socket.io-client';\nimport { autoDetectBackendUrl } from '../utils/networkUtils';\n\n// Create context\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SocketContext = /*#__PURE__*/createContext();\n\n// Socket Provider Component\nexport const SocketProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    user,\n    isAuthenticated\n  } = useAuth();\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n\n  // Real socket connection\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      console.log('Socket baƒülantƒ±sƒ± ba≈ülatƒ±lƒ±yor...');\n\n      // Auto-detect socket URL\n      autoDetectBackendUrl().then(apiUrl => {\n        // Convert API URL to Socket URL\n        const socketUrl = apiUrl.replace('/api', '');\n        console.log('üîå Socket URL:', socketUrl);\n        const newSocket = io(socketUrl, {\n          auth: {\n            token: localStorage.getItem('token')\n          },\n          transports: ['polling'],\n          timeout: 10000,\n          reconnection: true,\n          reconnectionAttempts: 5,\n          reconnectionDelay: 1000\n        });\n        newSocket.on('connect', () => {\n          console.log('Socket connected:', newSocket.id);\n          setConnected(true);\n          setSocket(newSocket);\n        });\n        newSocket.on('disconnect', reason => {\n          console.log('Socket disconnected:', reason);\n          setConnected(false);\n          setOnlineUsers([]);\n        });\n        newSocket.on('connect_error', error => {\n          console.error('Socket connection error:', error);\n          setConnected(false);\n        });\n        newSocket.on('reconnect', attemptNumber => {\n          console.log('Socket reconnected after', attemptNumber, 'attempts');\n          setConnected(true);\n        });\n        newSocket.on('onlineUsers', users => {\n          setOnlineUsers(users);\n        });\n        newSocket.on('notification', notification => {\n          console.log('New notification received:', notification);\n        });\n\n        // Socket'i hemen set et ama connected durumunu connect event'inde set et\n        setSocket(newSocket);\n\n        // Eƒüer socket zaten baƒülƒ±ysa connected'ƒ± true yap\n        if (newSocket.connected) {\n          console.log('Socket zaten baƒülƒ±, connected true yapƒ±lƒ±yor');\n          setConnected(true);\n        }\n        return () => {\n          console.log('Socket cleanup...');\n          newSocket.close();\n        };\n      });\n    } else {\n      setConnected(false);\n      setOnlineUsers([]);\n      if (socket) {\n        socket.close();\n        setSocket(null);\n      }\n    }\n  }, [isAuthenticated, user]);\n\n  // Real socket functions\n  const emitEvent = (eventName, data) => {\n    if (socket && connected) {\n      socket.emit(eventName, data);\n      return true;\n    }\n    return false;\n  };\n  const joinRoom = roomName => {\n    if (socket && connected) {\n      socket.emit('joinRoom', roomName);\n      return true;\n    }\n    return false;\n  };\n  const leaveRoom = roomName => {\n    if (socket && connected) {\n      socket.emit('leaveRoom', roomName);\n      return true;\n    }\n    return false;\n  };\n  const sendNotification = notification => {\n    if (socket && connected) {\n      socket.emit('sendNotification', notification);\n      return true;\n    }\n    return false;\n  };\n  const updateUserStatus = status => {\n    if (socket && connected) {\n      socket.emit('updateStatus', status);\n      return true;\n    }\n    return false;\n  };\n  const broadcastToRole = (role, message) => {\n    console.log('Mock broadcast to role:', role, message);\n    return true;\n  };\n  const isUserOnline = userId => {\n    return onlineUsers.some(user => user.userId === userId);\n  };\n  const getOnlineUsersByRole = role => {\n    return onlineUsers.filter(user => user.role === role);\n  };\n  const getOnlineUsersCount = () => {\n    return onlineUsers.length;\n  };\n  const disconnectSocket = () => {\n    setConnected(false);\n    setOnlineUsers([]);\n    console.log('Mock socket disconnected');\n  };\n  const value = {\n    socket,\n    // Ger√ßek socket\n    connected,\n    onlineUsers,\n    // Functions\n    emitEvent,\n    joinRoom,\n    leaveRoom,\n    sendNotification,\n    updateUserStatus,\n    broadcastToRole,\n    // Utility functions\n    isUserOnline,\n    getOnlineUsersByRole,\n    getOnlineUsersCount,\n    // Control functions\n    disconnectSocket\n  };\n  return /*#__PURE__*/_jsxDEV(SocketContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 179,\n    columnNumber: 5\n  }, this);\n};\n\n// Hook to use socket context\n_s(SocketProvider, \"4ozYEU3tEKVM6ugMf7t7fW/MguI=\", false, function () {\n  return [useAuth];\n});\n_c = SocketProvider;\nexport const useSocket = () => {\n  _s2();\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n_s2(useSocket, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default SocketContext;\nvar _c;\n$RefreshReg$(_c, \"SocketProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useAuth","io","autoDetectBackendUrl","jsxDEV","_jsxDEV","SocketContext","SocketProvider","children","_s","user","isAuthenticated","socket","setSocket","connected","setConnected","onlineUsers","setOnlineUsers","console","log","then","apiUrl","socketUrl","replace","newSocket","auth","token","localStorage","getItem","transports","timeout","reconnection","reconnectionAttempts","reconnectionDelay","on","id","reason","error","attemptNumber","users","notification","close","emitEvent","eventName","data","emit","joinRoom","roomName","leaveRoom","sendNotification","updateUserStatus","status","broadcastToRole","role","message","isUserOnline","userId","some","getOnlineUsersByRole","filter","getOnlineUsersCount","length","disconnectSocket","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useSocket","_s2","context","Error","$RefreshReg$"],"sources":["/Users/hakankarahan/Desktop/fabrikayazilimi/frontend/src/contexts/SocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { useAuth } from './AuthContext';\nimport { io } from 'socket.io-client';\nimport { autoDetectBackendUrl } from '../utils/networkUtils';\n\n// Create context\nconst SocketContext = createContext();\n\n// Socket Provider Component\nexport const SocketProvider = ({ children }) => {\n  const { user, isAuthenticated } = useAuth();\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n\n  // Real socket connection\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      console.log('Socket baƒülantƒ±sƒ± ba≈ülatƒ±lƒ±yor...');\n      \n      // Auto-detect socket URL\n      autoDetectBackendUrl().then(apiUrl => {\n        // Convert API URL to Socket URL\n        const socketUrl = apiUrl.replace('/api', '');\n        console.log('üîå Socket URL:', socketUrl);\n        \n        const newSocket = io(socketUrl, {\n        auth: {\n          token: localStorage.getItem('token')\n        },\n        transports: ['polling'],\n        timeout: 10000,\n        reconnection: true,\n        reconnectionAttempts: 5,\n        reconnectionDelay: 1000\n      });\n\n      newSocket.on('connect', () => {\n        console.log('Socket connected:', newSocket.id);\n        setConnected(true);\n        setSocket(newSocket);\n      });\n\n      newSocket.on('disconnect', (reason) => {\n        console.log('Socket disconnected:', reason);\n        setConnected(false);\n        setOnlineUsers([]);\n      });\n\n      newSocket.on('connect_error', (error) => {\n        console.error('Socket connection error:', error);\n        setConnected(false);\n      });\n\n      newSocket.on('reconnect', (attemptNumber) => {\n        console.log('Socket reconnected after', attemptNumber, 'attempts');\n        setConnected(true);\n      });\n\n      newSocket.on('onlineUsers', (users) => {\n        setOnlineUsers(users);\n      });\n\n      newSocket.on('notification', (notification) => {\n        console.log('New notification received:', notification);\n      });\n\n      // Socket'i hemen set et ama connected durumunu connect event'inde set et\n      setSocket(newSocket);\n      \n      // Eƒüer socket zaten baƒülƒ±ysa connected'ƒ± true yap\n      if (newSocket.connected) {\n        console.log('Socket zaten baƒülƒ±, connected true yapƒ±lƒ±yor');\n        setConnected(true);\n      }\n\n        return () => {\n          console.log('Socket cleanup...');\n          newSocket.close();\n        };\n      });\n    } else {\n      setConnected(false);\n      setOnlineUsers([]);\n      if (socket) {\n        socket.close();\n        setSocket(null);\n      }\n    }\n  }, [isAuthenticated, user]);\n\n  // Real socket functions\n  const emitEvent = (eventName, data) => {\n    if (socket && connected) {\n      socket.emit(eventName, data);\n      return true;\n    }\n    return false;\n  };\n\n  const joinRoom = (roomName) => {\n    if (socket && connected) {\n      socket.emit('joinRoom', roomName);\n      return true;\n    }\n    return false;\n  };\n\n  const leaveRoom = (roomName) => {\n    if (socket && connected) {\n      socket.emit('leaveRoom', roomName);\n      return true;\n    }\n    return false;\n  };\n\n  const sendNotification = (notification) => {\n    if (socket && connected) {\n      socket.emit('sendNotification', notification);\n      return true;\n    }\n    return false;\n  };\n\n  const updateUserStatus = (status) => {\n    if (socket && connected) {\n      socket.emit('updateStatus', status);\n      return true;\n    }\n    return false;\n  };\n\n  const broadcastToRole = (role, message) => {\n    console.log('Mock broadcast to role:', role, message);\n    return true;\n  };\n\n  const isUserOnline = (userId) => {\n    return onlineUsers.some(user => user.userId === userId);\n  };\n\n  const getOnlineUsersByRole = (role) => {\n    return onlineUsers.filter(user => user.role === role);\n  };\n\n  const getOnlineUsersCount = () => {\n    return onlineUsers.length;\n  };\n\n  const disconnectSocket = () => {\n    setConnected(false);\n    setOnlineUsers([]);\n    console.log('Mock socket disconnected');\n  };\n\n  const value = {\n    socket, // Ger√ßek socket\n    connected,\n    onlineUsers,\n    \n    // Functions\n    emitEvent,\n    joinRoom,\n    leaveRoom,\n    sendNotification,\n    updateUserStatus,\n    broadcastToRole,\n    \n    // Utility functions\n    isUserOnline,\n    getOnlineUsersByRole,\n    getOnlineUsersCount,\n    \n    // Control functions\n    disconnectSocket,\n  };\n\n  return (\n    <SocketContext.Provider value={value}>\n      {children}\n    </SocketContext.Provider>\n  );\n};\n\n// Hook to use socket context\nexport const useSocket = () => {\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n\nexport default SocketContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}